!function(t,e){"use strict";"function"==typeof define?define.amd?define(function(t){var i=t("jquery"),n=t("lodash"),o=t("backbone"),r=t("backbone.view"),s=t("sidebar"),a=t("template");return e(i,n,o,r,a,s)}):define.cmd&&define(function(t,i,n){var o=t("jquery"),r=t("lodash"),s=t("backbone"),a=t("backbone.view"),d=t("sidebar"),c=t("template");return e(o,r,s,a,c,d)}):t.scrollView=e(t.scrollView)}(this,function(t,e,i,n,o,r){"use strict";function s(){this.enabledHeader=!0,this.touchTargetId=this.view=this.sideView=this.view=this.plugins=this.store=this.data=this.columns=this.title=null,this.$touchEl=this.$context=this.$storeContextEl=null,this.delegatesEvents={},this.colSize=0,this.rowSize=0,this.meshSize=0,this.maxMeshSize=12,this.displayColumns=[]}s.prototype.initConfiguration=function(t){this.view=t,this.enabledHeader=t.getAttr("enabledHeader")||!0,this.plugins=t.getAttr("plugins")||null,this.columns=t.getAttr("columns")||null,this.title=t.getAttr("title")||null,this.data=t.getAttr("data")||[],this.touchTargetId=t.getAttr("touchTargetId")||null,this.delegatesEvents.editEvent=t.getAttr("editAction")||void 0,this.delegatesEvents.deleteEvent=t.getAttr("deleteAction")||void 0,this.delegatesEvents.infoEvent=t.getAttr("infoAction")||void 0,this.delegatesEvents.onSubmit=t.getAttr("onSubmit")||void 0,this.initGridView()},s.prototype.touchEvent=function(e,i,n){var o=i||document.body,r=!1;t(e,o).bind("touchstart",function(t){r=!0,n.start(t)}),t(e,o).bind("touchmove",function(t){r=!1,n.move(t)}),t(e,o).bind("touchend",function(t){r&&n.end(t)})},s.prototype.collectDigitSize=function(){var t=this,e=t.meshSize;this.displayColumns.forEach(function(i,n){if(isNaN(i.digit))throw Error("column.digit 参数值只能为数字类型");var o=i.digit||0;e+=parseInt(o),i.meshClass=t.defineMeshClass(i.digit)}),t.meshSize=e},s.prototype.checkMeshSize=function(){return this.meshSize>this.maxMeshSize},s.prototype.defineMeshClass=function(t){switch(t){case 1:return"am-u-sm-1";case 2:return"am-u-sm-2";case 3:return"am-u-sm-3";case 4:return"am-u-sm-4";case 5:return"am-u-sm-5";case 6:return"am-u-sm-6";case 7:return"am-u-sm-7";case 8:return"am-u-sm-8";case 9:return"am-u-sm-9";case 10:return"am-u-sm-10";case 11:return"am-u-sm-11";case 12:return"am-u-sm-12";default:return"am-u-sm-12"}},s.prototype.initGridView=function(){this.verifyRegular(),this.createSiderView(),this.createPlugins(),this.createGridHeader(),this.createGridColumnContext(),this.createStoreContextEl(),this.render()},s.prototype.verifyRegular=function(){var e=this.$touchEl=t("#"+this.touchTargetId);if(0===e.length)throw new Error("找不到指定 "+this.touchTargetId+" id element")},s.prototype.createSiderView=function(){var t=this;this.sideView=new r({title:t.title,returnIcon:"icon_return",style:{zIndex:3119},submit:function(){t.delegatesEvents.onSubmit&&t.delegatesEvents.onSubmit()}});var e=this.sideView.getAttr("sidebar");this.$context=e.$context,this.touchEvent(t.$touchEl,null,{start:function(t){},move:function(t){},end:function(e){t.sideView.open()}})},s.prototype.initStore=function(){var t=this,e=t.data||[],i=t.store||[];0!=e.length&&(e.forEach(function(e,n){var o=t.convertToStoreRecord(e);i.push(o)}),t.store=i)},s.prototype.convertToStoreRecord=function(t){var e=this.displayColumns,i=new Object({data:t});return i.get=function(t){var e=this[t]||{};return e.text||""},e.forEach(function(e,n){var o=e.type,r=e.field||"action";t[r]||"",e.meshClass||"am-u-sm-12";i[r]={index:n,text:t[e.field],type:o,meshClass:e.meshClass}}),i},s.prototype.createPlugins=function(){if(this.plugins){var e=t("<div>",{id:"gridview-tools"+this.touchTargetId,"class":"am-plugins-gridview-tools"});e.appendTo(this.$context),this.plugins.forEach(function(i,n){var o=t("<div>"),r=t("<i>",{"class":"icon_add"});r.appendTo(o);var s=t("<label>");s.text(i.title),s.appendTo(o);var a=t("<i>",{"class":"icon_right_arrow"});a.css({"float":"right"}),a.appendTo(o),o.appendTo(e),i.touch&&t(o).bind("touchend",function(t){i.touch(t)})})}},s.prototype.checkColSize=function(){var t=this,e=t.colSize,i=t.displayColumns;this.columns.forEach(function(t,n){++e,t.display&&i.push(t)}),t.colSize=e,t.displayColumns=i},s.prototype.createGridHeader=function(){},s.prototype.createStoreContextEl=function(){this.$storeContextEl=t("<div>",{id:"gridview-store-context","class":"am-plugins-gridview-storecontext"}),this.$storeContextEl.appendTo(this.$context)},s.prototype.createGridColumnContext=function(){if(this.checkColSize(),this.collectDigitSize(),this.checkMeshSize())throw Error("meshSize transboundary(网格数量越界，digit属性累计只能 <=12)");this.initStore()},s.prototype.onload=function(){},s.prototype.reload=function(){this.render()},s.prototype.onloadData=function(t){},s.prototype.getData=function(){return this.data},s.prototype.getStore=function(){},s.prototype.addRecord=function(t){var e=this.convertToStoreRecord(t);this.store.push(e),this.data.push(t)},s.prototype.updateRecord=function(e){var i=this.convertToStoreRecord(e),n=this.findBy("id",e.id);if(!n)throw new Errow("updateRecord error");t.extend(n,i),t.extend(n.data,i.data)},s.prototype.findBy=function(t,e){var i=null;return this.store.forEach(function(n,o){var r=n.data[t];return r==e?void(i=n):void 0}),i},s.prototype.render=function(){var t=this,e=t.store;t.$storeContextEl.empty(),e.forEach(function(e,i){var n=t.renderRow(e);t.renderColumn(e,n),n.appendTo(t.$storeContextEl)})},s.prototype.renderRow=function(e){return t("<div>",{"class":"am-g"})},s.prototype.renderColumn=function(t,e){var i=this;i.displayColumns.forEach(function(n,o){var r=n.field||"action",s=t[r],a=s.type,d="action"===a?i.renderActionColumn(s):i.renderDataTypeColumn(s);d.appendTo(e)});var i=this;this.delegatesEvents.editEvent&&this.touchEvent("i",e.get(0),{start:function(t){},move:function(t){},end:function(e){i.delegatesEvents.editEvent(t)}})},s.prototype.renderDataTypeColumn=function(e,i){var n=t("<div>",{"class":e.meshClass+" column"});return n.text(e.text),n},s.prototype.renderActionColumn=function(e,i){var n=t("<div>",{"class":e.meshClass+" column"}),o=t("<i>",{"class":"icon_edit"});return o.appendTo(n),n},s.prototype.generateMixed=function(t){for(var e="",i=0;t>i;i++){var n=Math.ceil(35*Math.random());e+=this.chars[n]}return e},s.prototype.chars=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],s.prototype.open=function(){this.sideView.open()};var a=i.Model.extend({idAttribute:"",defaults:{}});return n.extend({id:"",model:new a,attrs:{parentNode:null},events:{},open:function(t){var e=this.getAttr("sideGridView");e.open()},addRecord:function(t){var e=this.getAttr("sideGridView");e.addRecord(t)},updateRecord:function(t){var e=this.getAttr("sideGridView");e.updateRecord(t)},getData:function(){var t=this.getAttr("sideGridView");return t.getData()},reload:function(){var t=this.getAttr("sideGridView");t.reload()},setup:function(){var t=this,e=new s;e.initConfiguration(t),t.setAttr("sideGridView",e),document.addEventListener("touchmove",function(t){t.preventDefault()},!1)}})});