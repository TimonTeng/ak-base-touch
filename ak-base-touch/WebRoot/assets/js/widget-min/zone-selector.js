!function(t,e){"use strict";"function"==typeof define?define.amd?define(function(t){var o=t("jquery"),i=t("lodash"),n=t("backbone"),r=t("backbone.view"),a=t("sidebar"),c=t("alphabetBar"),d=t("template");return e(o,i,n,r,d,c,a)}):define.cmd&&define(function(t,o,i){var n=t("jquery"),r=t("lodash"),a=t("backbone"),c=t("backbone.view"),d=t("sidebar"),s=t("alphabetBar"),p=t("template");return e(n,r,a,c,p,s,d)}):t.ZoneSelector=e(t.ZoneSelector)}(this,function(t,e,o,i,n,r,a){"use strict";function c(){this.type=d.City,this.alphabet=!0,this.alphabetBar=this.view=this.sidebar=this.title=null,this.config={province:null,city:null,district:null},this.JsonReader={province:{},city:{},district:{}},this.data={province:null,city:null,district:null},this.selectData={province:null,city:null,district:null},this.$provinceBody=this.$cityBody=this.$district=this.$context=this.$body=null,this.provinceMeshSize=this.cityMeshSize=this.districtMeshSize=12,this.rootIScroll=null}var d={Province:"Province",City:"City",ProvinceCity:"ProvinceCity",ProvinceCityDistrict:"ProvinceCityDistrict"};c.prototype.initConfiguration=function(t){var e=this;e.view=t||null,e.config.province=t.getAttr("province")||void 0,e.config.city=t.getAttr("city")||void 0,e.config.district=t.getAttr("district")||void 0,e.title=t.getAttr("title")||"",e.type=t.getAttr("type")||this.type,e.alphabet=t.getAttr("alphabet")||this.alphabet,e.alphabet&&(e.alphabetBar=new r,e.alphabetBar.alphabetBarView.bindSelectView(e)),e.validationConfiguration()&&e.initViewMode()},c.prototype.validationConfiguration=function(){return!0},c.prototype.initViewMode=function(){this.createSidebar(),this.createViewMode(),this.renderViewMode()},c.prototype.provinceMode=function(){var e=this;e.createBody(),e.createProvinceBody(),e.$provinceBody.appendTo(e.$body),e.$body.appendTo(e.$context),e.createZoneDataContext(e.$provinceBody);var o=e.config,i=e.JsonReader;i.province.scroll=e.rootIScroll=e.createScroll("#province-body"),t.extend(i.province,o.province,e.provinceJsonReaderOptions()),e.initload=function(){e.load(i.province)}},c.prototype.cityMode=function(){var e=this;e.createBody(),e.createCityBody(),e.$cityBody.appendTo(e.$body),e.$body.appendTo(e.$context),e.createZoneDataContext(e.$cityBody);var o=e.config,i=e.JsonReader;i.city.scroll=e.rootIScroll=e.createScroll("#city-body"),t.extend(i.city,o.city,e.cityJsonReaderOptions()),e.initload=function(){e.load(i.city)}},c.prototype.provinceCityMode=function(){var e=this;e.createBody(),e.createProvinceBody(),e.createCityBody(),e.$provinceBody.appendTo(e.$body),e.$cityBody.appendTo(e.$body),e.$body.appendTo(e.$context),e.createZoneDataContext(e.$provinceBody),e.createZoneDataContext(e.$cityBody);var o=e.config,i=e.JsonReader;i.province.scroll=e.rootIScroll=e.createScroll("#province-body"),i.city.scroll=e.createScroll("#city-body"),t.extend(i.province,o.province,e.provinceJsonReaderOptions()),t.extend(i.city,o.city,e.cityJsonReaderOptions()),e.scrollTigger(i.province),e.scrollTigger(i.city),e.initload=function(){e.load(i.province)}},c.prototype.provinceCityDistrictMode=function(){var e=this;e.createBody(),e.createProvinceBody(),e.createCityBody(),e.createDistrictBody(),e.$provinceBody.appendTo(e.$body),e.$cityBody.appendTo(e.$body),e.$districtBody.appendTo(e.$body),e.$body.appendTo(e.$context),e.createZoneDataContext(e.$provinceBody),e.createZoneDataContext(e.$cityBody),e.createZoneDataContext(e.$districtBody);var o=e.config,i=e.JsonReader;i.province.scroll=e.rootIScroll=e.createScroll("#province-body"),i.city.scroll=e.createScroll("#city-body"),i.district.scroll=e.createScroll("#district-body"),t.extend(i.province,o.province,e.provinceJsonReaderOptions()),t.extend(i.city,o.city,e.cityJsonReaderOptions()),t.extend(i.district,o.district,e.districtJsonReaderOptions()),e.initload=function(){e.load(i.province)}},c.prototype.scrollTigger=function(t){var e=t.scroll;e.on("scrollStart",function(){}),e.on("scrollEnd",function(){})},c.prototype.createScroll=function(t){return new IScroll(t,{click:!0})},c.prototype.selectedAllOff=function(e,o){t("[selected]",e).css("backgroundColor","#fff"),this.selectData[o]=null},c.prototype.selectedOff=function(e,o){t(e).data("object");e.style.backgroundColor="#fff",e.removeAttribute("selected"),this.selectData[o]=null},c.prototype.selectedOn=function(e,o){var i=t(e).data("object");e.style.backgroundColor="#ececec",e.setAttribute("selected",!0),this.selectData[o]=i},c.prototype.provinceJsonReaderOptions=function(){var e=this,o=t(".zone-data-context",e.$provinceBody);return{renderData:e.renderAlphabetDataContext,$dataContext:o,bindEvent:function(i){e.touchEvent(".warp_context li",o,{start:function(i){e.selectedAllOff(o,"province"),e.selectedOn(i.target,"province"),e.$cityBody&&t(".zone-data-context",e.$cityBody).empty(),e.$districtBody&&t(".zone-data-context",e.$districtBody).empty()},move:function(t){e.selectedOff(t.target,"province")},end:function(t){var o=e.JsonReader.city;e.load(o)}})}}},c.prototype.cityJsonReaderOptions=function(){var e=this,o=t(".zone-data-context",e.$cityBody);return{renderData:function(){return e.type===d.City?e.renderAlphabetDataContext:e.renderDataContext}(),$dataContext:o,getUrl:function(){return e.selectData.province?this.apiUrl+"?"+this.parentQueryName+"="+e.selectData.province.id:this.apiUrl},bindEvent:function(i){e.touchEvent(".warp_context li",o,{start:function(i){e.selectedAllOff(o,"city"),e.selectedOn(i.target,"city"),e.$districtBody&&t(".zone-data-context",e.$districtBody).empty()},move:function(t){e.selectedOff(t.target,"city")},end:function(t){var o=e.JsonReader.district;e.load(o)}})}}},c.prototype.districtJsonReaderOptions=function(){var e=this,o=t(".zone-data-context",e.$districtBody);return{renderData:e.renderDataContext,$dataContext:o,getUrl:function(){return e.selectData.city?this.apiUrl+"?"+this.parentQueryName+"="+e.selectData.city.id:this.apiUrl},bindEvent:function(t){e.touchEvent(".warp_context li",o,{start:function(t){e.selectedAllOff(o,"district"),e.selectedOn(t.target,"district")},move:function(t){e.selectedOff(t.target,"district")},end:function(t){}})}}},c.prototype.createViewMode=function(){var t=this;switch(t.type){case d.Province:t.setBodyMeshSize(12,0,0),t.provinceMode();break;case d.City:t.setBodyMeshSize(0,12,0),t.cityMode();break;case d.ProvinceCity:t.setBodyMeshSize(6,6,0),t.provinceCityMode();break;case d.ProvinceCityDistrict:t.setBodyMeshSize(4,4,4),t.provinceCityDistrictMode()}},c.prototype.setBodyMeshSize=function(t,e,o){this.provinceMeshSize=t,this.cityMeshSize=e,this.districtMeshSize=o},c.prototype.createZoneDataContext=function(e){var o=t("<div>",{"class":"zone-data-context"});o.appendTo(e)},c.prototype.createProvinceBody=function(){this.$provinceBody=t("<div>",{"class":"zone-data am-padding-0 am-u-sm-"+this.provinceMeshSize,id:"province-body"})},c.prototype.createCityBody=function(){this.$cityBody=t("<div>",{"class":"zone-data am-padding-0 am-u-sm-"+this.cityMeshSize,id:"city-body"})},c.prototype.createDistrictBody=function(){this.$districtBody=t("<div>",{"class":"zone-data am-padding-0 am-u-sm-"+this.districtMeshSize,id:"district-body"})},c.prototype.createBody=function(){this.$body=t("<div>",{"class":"am-g am-plugin-zone-body",id:"zone-body"})},c.prototype.createSidebar=function(){var t=this;t.sidebar=new a({title:t.title,returnIcon:"icon_return",style:{zIndex:2013},submit:function(){t.submit()},returnAfter:function(){}}),this.$context=t.sidebar.getAttr("sidebar").$context},c.prototype.renderDataContext=function(e){e.$dataContext.empty();var o=e.data||[],i=t("<ul>",{"class":"warp_context"});o.forEach(function(o,n){var r=t("<li>",{"data-object":JSON.stringify(o),"data-select":!1});r.text(o[e.displayField]),r.appendTo(i)}),i.appendTo(e.$dataContext),e.scroll.refresh(),e.bindEvent()},c.prototype.renderAlphabetDataContext=function(e){e.$dataContext.empty();var o=e.data;o.forEach(function(o,i){var n=t("<div>",{id:"warp_alphabet_"+o.code,"class":"warp_alphabet_mark"}),r=t("<div class='warp_alphabet_title'><li><h2>"+o.code+"</h2></li></div>");t(r).appendTo(n);var a=t("<ul>",{id:"warp_u_"+o.code,"class":"warp_context"});t(a).appendTo(n);var c=o.data||[],d=t("<ul>",{"class":"warp_context"});c.forEach(function(o,i){var n=t("<li>",{"data-object":JSON.stringify(o),"data-select":!1});n.text(o[e.displayField]),n.appendTo(d)}),d.appendTo(n),n.appendTo(e.$dataContext)}),e.scroll.refresh(),e.bindEvent()},c.prototype.renderViewMode=function(){var t=this,e=t.$body.height()-20;t.alphabetBar.alphabetBarView.renderTo(t.$body,e)},c.prototype.submit=function(){var t=this,e=t.view.getAttr("submit");e&&e(t.selectData)},c.prototype.load=function(e){var o=this,i=e.getUrl?e.getUrl():e.apiUrl;t.getJSON(i,null,function(t){e.data=t[e.result],e.renderData(e),o.sidebar.open()})},c.prototype.open=function(){this.initload(),this.sidebar.open(),this.renderAlphabetbar()},c.prototype.renderAlphabetbar=function(){var t=this,e=t.$body.height()-20;t.alphabetBar.alphabetBarView.positionHeight(e),t.alphabetBar.alphabetBarView.positionAlphabetOffsetY()},c.prototype.touchEvent=function(e,o,i){t.touchEvent(e,o,i)};var s=o.Model.extend({idAttribute:"",defaults:{}});return i.extend({id:"",model:new s,attrs:{parentNode:null},events:{},setup:function(){var t=this,e=new c;e.initConfiguration(t),t.setAttr("zoneSelector",e),document.addEventListener("touchmove",function(t){t.preventDefault()},!1)},open:function(){var t=this.getAttr("zoneSelector");t.open()}})});