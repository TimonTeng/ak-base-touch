!function(t,e){"use strict";"function"==typeof define?define.amd?define(function(t){var n=t("jquery"),o=t("lodash"),r=t("backbone"),i=t("backbone.view"),l=t("template");return e(n,o,r,i,l)}):define.cmd&&define(function(t,n,o){var r=t("jquery"),i=t("lodash"),l=t("backbone"),s=t("backbone.view"),a=t("template");return e(r,i,l,s,a)}):t.scrollView=e(t.scrollView)}(this,function(t,e,n,o,r){"use strict";function i(){this.items=this.view=this.loadComplete=this.scrollView=null,this.contextItems=[],this.$parentNode=null,this.threads=0}i.prototype.initConfiguration=function(e){this.view=e,this.scrollView=e.getAttr("scrollView"),this.contextItems=e.getAttr("items")||[],this.loadComplete=e.getAttr("loadComplete");var n=e.getAttr("parentNode");if(this.$parentNode=t(n),0===this.contextItems.length)throw Error("ContextView attribute items unspecified");if(0===this.$parentNode.length)throw Error("ContextView attribute parentNode unspecified");if(!this.scrollView)throw Error("ContextView attribute scrollView unspecified");this.init()},i.prototype.init=function(){this.renderComplete();for(var t=0;t<this.contextItems.length;t++){var e=this.contextItems[t],n=this.createContextElement(e,t),o="templateOnly"in e?"loadTemplateOnly":"loadContext";this[o](e,n)}},i.prototype.renderComplete=function(){var t=this;if(t.loadComplete)var e=setInterval(function(){t.threads==t.contextItems.length&&(t.loadComplete(),t.scrollView.refresh(),clearInterval(e))},500)},i.prototype.renderItemComplete=function(){++this.threads},i.prototype.createContextElement=function(e,n){var o=e.id||"am-plugin-context-view"+n,r=t("<div>",{id:o});return r.appendTo(this.$parentNode),r},i.prototype.renderContext=function(t,e){var n=t.template,o=r.compile(n,e);return o},i.prototype.appendToParentNode=function(t,e,n){n.html(e),t.renderAfter&&t.renderAfter(n),this.renderItemComplete()},i.prototype.loadTemplateOnly=function(t,e){var n=this.renderContext(t,null);this.appendToParentNode(t,n,e)},i.prototype.loadContext=function(e,n){if(!e.result)throw Error("ContextView.items config.result attribute unspecified");var o=this;t.getJSON(e.apiUrl).then(function(t){var r=o.renderContext(e,t[e.result]);o.appendToParentNode(e,r,n)},function(){console.log("ContextView.loadContext Error...")})};var l=n.Model.extend({idAttribute:"",defaults:{}});return o.extend({id:"",model:new l,attrs:{parentNode:null},events:{},setup:function(){var t=this,e=new i;e.initConfiguration(t),t.setAttr("contextView",e),document.addEventListener("touchmove",function(t){t.preventDefault()},!1)}})});